{% extends "base.html" %}

{% block title %}{{ product.name }}{% endblock %}

{% block content %}
<div class="container mx-auto p-4 max-w-4xl">

  <!-- Product Name -->
  <h1 class="text-3xl font-bold mb-6">
    {{ product.name }}
  </h1>

  <!-- Product Image -->
  <div class="w-full mb-6">
    {% with product.images.first as image %}
      {% if image %}
        <img
          src="{{ image.image.url }}"
          alt="{{ product.name }}"
          class="w-full max-h-[500px] object-contain rounded shadow"
        />
      {% endif %}
    {% endwith %}
  </div>

  <!-- Product Details -->
  <div class="space-y-4">

    <p class="text-gray-700">
      {{ product.description }}
    </p>

    {% with product.variants.first as variant %}
      {% if variant %}
        <p class="text-2xl  text-blue-600 font-semibold ">
          Rs {{ variant.price }}
        </p>
      {% else %}
        <p class="text-sm text-gray-500">
          Price not available
        </p>
      {% endif %}
    {% endwith %}
              <form action= "{% url 'carts:cart_add' product.id %}" method="post" id ="add-to-cart-form">
            {% csrf_token %}
            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded">
            Add to Cart
            </button>
            <p id="cart-message" class="text-green-600 mt-2 hidden">Item added to cart!</p>
          </form>

  </div>

</div>
<script>
document.getElementById("add-to-cart-form").addEventListener("submit", function(event) {
  event.preventDefault();

  const form = event.target;
  const url = form.action;
  const formData = new FormData(form);
  const messageElement = document.getElementById("cart-message");

  fetch(url, {
    method: "POST",
    headers: {
      "X-CSRFToken": formData.get("csrfmiddlewaretoken"),
    },
    body: formData,
  })
  .then(response => response.json())
  .then(data => {
  messageElement.classList.remove("hidden");

  if (data.success) {
    messageElement.textContent = data.message;
    messageElement.className = "text-green-600 mt-2";
  } else {
    messageElement.textContent = "Failed to add item to cart.";
    messageElement.className = "text-red-600 mt-2";
  }

  setTimeout(() => {
    messageElement.classList.add("hidden");
  }, 2000);
})
});
</script>

{% endblock %}

